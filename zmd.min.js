!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define("zmd",[],t):"object"==typeof exports?exports.zmd=t():e.zmd=t()}(this,function(){function e(e,t){for(var n={},s=0;s<arguments.length;s++){var r=arguments[s];if(r)for(var i in r)d.call(r,i)&&(n[i]=r[i])}return n}function t(e,t){var n=0,s=e.length;if(void 0===s){for(n in e)if(!1===t.call(e[n],e[n],n))break}else for(;n<s&&!1!==t.call(e[n],e[n],n);n++);return e}function n(e){throw new Error(e)}function s(e){for(var t=e.source||e,n=e.flags||"",s=1;s<arguments.length;s++){var r=arguments[s],i=r[0],o=r[1];o=(o.source||o).replace(/^\^/g,""),t=t.replace(i,o)}return new RegExp(t,n)}function r(e,t){return e.replace(t?/[<>"']|&(?!#?\w+;)/g:/[&<>"']/g,function(e){return m[e]})}function i(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9a-f]+)|(?:\w+));?/gi,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function o(e){return String.prototype.trim?String.prototype.trim.call(e):e.replace(/^\s+|\s+$/g,"")}function l(){this.slugs=Object.create(null)}function a(e){this.tokens=[],this.tokens.fnrefs=Object.create(null),this.tokens.refs=Object.create(null),this.options=e||f.defaults,this.rules=k}function h(e,n){var s=[];if(e){var r=n.split("\n").length;t(e.split(","),function(e){if(e.indexOf("-")===-1){var t=+e;t&&t<=r&&s.push(t)}else for(var n=e.split("-"),i=+n[0];i<=+n[1]&&i<=r;i++)s.push(i)})}return s}function p(e,t){e=e.replace(/^ *\|?|\|? *$/g,"").replace(/\\\|/g,"\t").split(/ *\| */);for(var n=[],s=t||e.length,r=0;r<s;r++)n.push(e[r]?o(e[r].replace(/\t/g,"|")):"");return n}function c(e){this.options=e||f.defaults}function u(e,t,n){this.options=e||f.defaults,this.rules=x,this.refs=t||Object.create(null),n||(n=Object.create(null)),n.__n=[],this.fnrefs=n,this.renderer=new c(this.options)}function g(e){this.tokens=[],this.token=null,this.options=e||f.defaults,this.renderer=new c(this.options),this.slugger=new l}function f(t,n){if(!t)return"";n=e({},f.defaults,n);try{return g.parse(a.lex(t,n),n)}catch(e){if(e.message+="\nPlease report this to https://github.com/xovel/zmd.",n.silent)return"<p>An error occurred:</p><pre>"+r(e.message+"",!0)+"</pre>";throw e}}var d=Object.prototype.hasOwnProperty,m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};l.prototype.get=function(e){var t=i(o(e)).toLowerCase().replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,.\/:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-");return this.slugs[t]?t+="-"+this.slugs[t]++:this.slugs[t]=1,t};var b={punctuation:/[!"#$%&'()*+,\-.\/\u0021-\u002f:;<=>?@\u003a-\u0040[\\\]^_`\u005b-\u0060{|}~\u007b-\u007e]/,tagname:/[a-zA-Z][\w-]*/,attribute:/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*([^\s"'=<>`]+|'[^']*'|"[^"]*"))?/,opentag:/<tagname(?:attribute)*?\s*\/?>/,closingtag:/<\/tagname\s*>/,comment:/<!--(?!-?>)[\s\S]*?[^-]-->/,processing:/<\?[\s\S]*?\?>/,declaration:/<![A-Z]+\s+[^>]+>/,cdata:/<!\[CDATA\[[\s\S]+?\]\]>/,tag:/address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul/,label:/\[((?!\s*\])(?:\\[[\]]|[^[\]])+| *)\]/,destination:/<([^\n<>]*)>|((?!<)(?:\\[()]|\([^)\s]*\)|[^()\s])+)/,title:/"((?:(?:(?:\\"|[^"])*)|[^"\n]*(?:\n[^"\n]+)*\n?)+)"|'((?:(?:(?:\\'|[^'])*)|[^'\n]*(?:\n[^'\n]+)*\n?)+)'|\(((?:[^()]|(?:\([^)]*\)))+)\)/,dcell:/ *:? *-+ *:? */,delimiter:/(?:(?:dcell)?\|(?:(?:dcell)\|)*?(?:dcell)\|?|\|?(?:dcell)(?:(?:dcell)\|)*?\|(?:dcell)?)/,marker:/[*+-]|\d{1,9}[.)]/,scheme:/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,uri:/scheme:[^\s\x00-\x1f<>]*/,email:/[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/,autoemail:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/},k={hr:/^ {0,3}([-*_])( *\1){2,} *(?:\n+|$)/,heading:/^ {0,3}(#{1,6}) +([^\n]*?) *#* *(?:\n+|$)/,sheading:/^( {0,3}[^ \n]+(?:\n[^\n]+)*)\n {0,3}(=+|-+) *(?:\n+|$)/,code:/^( {4}[^\n]+\n*)+/,fence:/^ {0,3}(([~`])\2{2,})([^`\n]*)\n([\s\S]*?)(?: {0,3}\1\2* *(?:\n+|$)|$)/,html:/^ {0,3}(?:<(script|pre|style)[^>\n]*>[\s\S]*?(?:<\/\1>[^\n]*(?:\n+|$)|$)|(?:<!--[\s\S]*?-->|processing|<![\s\S]*?>|cdata)(?:[^\n]*\n+|$)|<\/?(tag)(?: +|\n|\/?)>[\s\S]*?(?:\n{2,}|$)|(?:<(?!script|pre|style)(?:tagname)(?:attribute)*?\s*\/?>|closingtag)[\s\S]*?(?:\n{2,}|$))+/i,ref:/^ {0,3}(?:label): *\n? *(?:destination) *\n? *(?:\s(?:title))? *(?:\n+|$)/,footnote:/^ {0,3}(?:label): *([^ \n][^\n]*(?:\n|$))/,paragraph:/^([^\n]+(?:\n(?!hr|heading|sheading| {0,3}(>|(`{3}|~{3})([^`\n]*)\n)|<\/?(?:tag)(?: +|\n|\/?>)|<(?:script|pre|style|!--))[^\n]+)*)/,newline:/^\n+/,text:/^[^\n]+/,table:/^([^\n]+)\n(delimiter) *\n((?:[^\n]+\n)*|$)/,formula:/^ {0,3}(\${2,})([\s\S]*?) {0,3}\1 *(?:\n+|$)/,deflist:/^ {0,3}([^ \n][^\n]*)\n((?::[^\n]+(?:\n+|$))+)/,div:/^ {0,3}(:{3,})([^\n]*)\n([\s\S]*?) {0,3}\1:* *(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3})(marker) [\s\S]+?(?:\n+(?=\1?hr)|\n+(?=ref)|\n{2,}(?! )(?!\1(?:marker) )\n*|\s*$)/,item:/^( *)(?:marker) ?[^\n]*(?:\n(?!\1(?:marker) ?)[^\n]*)*/gm,raw:/^ {0,3}\{(%)? *raw *\1\} *\n([\s\S]*?) {0,3}\{\1 *endraw *\1\}(?:\n+|$)/},x={escape:/^\\(punctuation)/,br:/^( {2,}|\\)\n(?!\s*$)/,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,autolink:/^<(uri|email)>/,autourl:/^((?:(?:ht|f)tps?:\/\/|www\.)(?:[\w-]+\.?)+[^\s<]*|email)/i,strong:/^__([^\s_])__(?!_)|^\*\*([^\s*])\*\*(?!\*)|^__([^\s][\s\S]*?[^\s])__(?!_)|^\*\*([^\s][\s\S]*?[^\s])\*\*(?!\*)/,em:/^_([^\s_])_(?!_)|^\*([^\s*<[])\*(?!\*)|^_([^\s<][\s\S]*?[^\s_])_(?!_|[^\spunctuation])|^_([^\s_<][\s\S]*?[^\s])_(?!_|[^\spunctuation])|^\*([^\s<"][\s\S]*?[^\s*])\*(?!\*|[^\spunctuation])|^\*([^\s*"<[][\s\S]*?[^\s])\*(?!\*)/,del:/^~~([\s\S]*?)~~/,ins:/^\+\+([\s\S]*?)\+\+/,mark:/^==([\s\S]*?)==/,sub:/^~([^~\n]+)~/,sup:/^\^([^^\n]+)\^/,formula:/^\$([^$\n]+?)\$/,link:/^!?(?:label)\(\s*(?:destination)(?:\s+(?:title))?\s*\)/,reflink:/^!?(?:label)\[(?!\s*\])((?:\\[[\]]|[^[\]])+)\]/,nolink:/^!?(?:label)(?:\[\s*\])?/,footnote:/^(?:label)(?!\[)/,html:/^(opentag|closingtag|comment|processing|declaration|cdata)/,text:/^(`+|[^`])(?:[\s\S]*?(?:(?=[\\<![`*~^]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{|}~-]+@))|(?= {2,}\n|[a-zA-Z0-9.!#$%&'*+\/=?_`{|}~-]+@))/};return b.opentag=s(b.opentag,["tagname",b.tagname],["attribute",b.attribute]),b.closingtag=s(b.closingtag,["tagname",b.tagname]),b.delimiter=s(b.delimiter,[/dcell/g,b.dcell]),b.uri=s(b.uri,["scheme",b.scheme]),k.html=s(k.html,["processing",b.processing],["cdata",b.cdata],["tagname",b.tagname],["attribute",b.attribute],["closingtag",b.closingtag],["tag",b.tag]),k.ref=s(k.ref,["label",b.label],["| *",""],["destination",b.destination],["title",b.title]),k.paragraph=s(k.paragraph,["hr",k.hr],["heading",k.heading],["sheading",k.sheading],["tag",b.tag]),k.table=s(k.table,["delimiter",b.delimiter]),k.blockquote=s(k.blockquote,["paragraph",k.paragraph]),k.list=s(k.list,[/marker/g,b.marker],["hr",s(k.hr,["\\1","\\2"],[" {0,3}",""])],["ref",s(k.ref,[" {0,3}",""])]),k.bullet=s(/^ *(marker) */,["marker",b.marker]),k.item=s(k.item,[/marker/g,b.marker]),k.footnote=s(k.footnote,["label",b.label],["| *",""],["\\[","\\[\\^"],["label",b.label]),x.escape=s(x.escape,["punctuation",b.punctuation]),x._escape=s(/\\(punctuation)/g,["punctuation",b.punctuation]),x.autolink=s(x.autolink,["uri",b.uri],["email",b.email],["@","(@)"]),x.autourl=s(x.autourl,["email",b.autoemail]),x.strong=s(x.strong,[/punctuation/g,b.punctuation]),x.link=s(x.link,["label",b.label],["destination",b.destination],["title",b.title]),x.reflink=s(x.reflink,["label",b.label]),x.nolink=s(x.nolink,["label",b.label],["| *",""]),x.footnote=s(x.footnote,["label",b.label],["| *",""],["\\[","\\[\\^"]),x.html=s(x.html,["opentag",b.opentag],["closingtag",b.closingtag],["comment",b.comment],["processing",b.processing],["declaration",b.declaration],["cdata",b.cdata]),a.rules=k,a.lex=function(e,t){var n=new a(t);return n.lex(e)},a.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.parse(e,!0)},a.prototype.parse=function(e,t){e=e.replace(/^ +$/gm,"");for(var s,r,i,l,a,c,u,g,f,d,m,b,x,y;e;)if((s=this.rules.newline.exec(e))&&(e=e.substring(s[0].length)),s=this.rules.raw.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"raw",text:s[2]});else if(s=this.rules.code.exec(e)){e=e.substring(s[0].length);var _=this.tokens.slice(-1)[0];_&&"paragraph"===_.type?_.text+="\n"+s[0].replace(/\s+$/,""):this.tokens.push({type:"code",text:s[0].replace(/^ {4}/gm,"").replace(/\n+$/,"")})}else if(s=this.rules.fence.exec(e))e=e.substring(s[0].length),r=(s[3]||"").match(/\s*([^\s]*)\s*(?:\{([^}]+)\})?/),s=s[4]||"",this.tokens.push({type:"fence",lang:r[1],lines:h(r[2],s),text:s.replace(/\n$/,"")});else if((s=this.rules.table.exec(e))&&(i={type:"table",header:p(s[1]),align:s[2].replace(/^ *\|?|\|? *$/g,"").split(/ *\| */),cells:s[3]?s[3].replace(/\n+$/,"").split("\n"):[]},i.header.length===i.align.length)){for(e=e.substring(s[0].length),l=0;l<i.align.length;l++)/^ *: *-+ *$/.test(i.align[l])?i.align[l]="left":/^ *: *-+ *: *$/.test(i.align[l])?i.align[l]="center":/^ *-+ *: *$/.test(i.align[l])?i.align[l]="right":i.align[l]=null;for(l=0;l<i.cells.length;l++)i.cells[l]=p(i.cells[l],i.header.length);this.tokens.push(i)}else if((s=this.rules.div.exec(e))&&(e=e.substring(s[0].length),this.tokens.push({type:"div_open",kls:s[2]||""}),this.parse(s[0],t),this.tokens.push({type:"div_close"})),s=this.rules.hr.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"hr"});else if(s=this.rules.heading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"heading",level:s[1].length,text:s[2]});else if(s=this.rules.blockquote.exec(e)){for(e=e.substring(s[0].length),this.tokens.push({type:"blockquote_open"}),g=s[0].replace(/^ *> ?/gm,""),u=1;/^ {0,3}>/.test(g);)u++,this.tokens.push({type:"blockquote_open"}),g=g.replace(/^ *> ?/gm,"");for(this.parse(g,t),l=0;l<u;l++)this.tokens.push({type:"blockquote_close"})}else if(s=this.rules.list.exec(e)){for(e=e.substring(s[0].length),b={type:"list_open",start:parseInt(s[2],10)||0,loose:!1},this.tokens.push(b),s=s[0].match(this.rules.item),c=s.length,x=[],d=!1,y=[],l=0;l<c;l++){if(g=s[l],m=g.length,g=g.replace(k.bullet,function(e,t){return y[l]=t[t.length-1],""}),m-=g.length,l>0&&y[l-1]!==y[l]){if(b.loose)for(a=0;a<x.length;a++)x[a].loose=!0;this.tokens.push({type:"list_close"}),this.tokens.push({type:"list_open"}),x=[],d=!1}f=d||/\n\n(?!\s*$)/.test(g),l!==c-1&&(d="\n"===g.charAt(g.length-1),f||(f=d)),f&&(b.loose=!0),i={type:"item_open",task:/^\[[ x]\]/i.test(g)},i.task&&(i.checked=" "!==g[1],g=g.replace(/^\[[ x]\] +/i,"")),x.push(i),this.tokens.push(i),this.parse(g.replace(new RegExp("^ {2,"+m+"}","gm"),""),!1),this.tokens.push({type:"item_close"})}if(b.loose)for(l=0;l<x.length;l++)x[l].loose=!0;this.tokens.push({type:"list_close"})}else if(s=this.rules.html.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"html",text:s[0]});else if(this.options.footnote&&(s=this.rules.footnote.exec(e)))e=e.substring(s[0].length),g=o(s[1]).toLowerCase().replace(/\s+/g," "),this.tokens.fnrefs[g]={text:o(s[2])};else if(this.options.formula&&(s=this.rules.formula.exec(e)))e=e.substring(s[0].length),this.tokens.push({type:"formula",raw:s[0],text:s[2]});else if(t&&(s=this.rules.ref.exec(e)))e=e.substring(s[0].length),i=o(s[1]).toLowerCase().replace(/\s+/g," "),this.tokens.refs[i]||(this.tokens.refs[i]={href:o(s[2]||s[3]||""),title:o(s[4]||s[5]||s[6]||"")});else if(s=this.rules.sheading.exec(e))e=e.substring(s[0].length),this.tokens.push({type:"heading",level:"-"===s[2][0]?2:1,text:s[1]});else if(s=this.rules.deflist.exec(e)){for(e=e.substring(s[0].length),i={type:"deflist",dt:s[1],dd:s[2].replace(/\n+$/,"").split("\n")},l=0;l<i.dd.length;l++)i.dd[l]=i.dd[l].replace(/^: */,"");this.tokens.push(i)}else t&&(s=this.rules.paragraph.exec(e))?(e=e.substring(s[0].length),this.tokens.push({type:"paragraph",text:s[1].replace(/\n+$/,"")})):(s=this.rules.text.exec(e))?(e=e.substring(s[0].length),this.tokens.push({type:"text",text:s[0]})):e&&n("Unrecognized byte:"+e.charCodeAt(0));return this.tokens},c.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},c.prototype.br=function(){return this.options.xhtml?"<br/>\n":"<br>\n"},c.prototype.heading=function(e,t,n){return"<h"+t+n+">"+e+"</h"+t+">\n"},c.prototype.code=function(e){return"<pre><code>"+r(e)+"</code></pre>"},c.prototype.fence=function(e,t,n){var s,i;if(this.options.highlight&&(i=this.options.highlight(e,t),i&&i!==e&&(e=i,s=!0)),i='<pre><code class="'+this.options.langPrefix+r(t,!0)+'">'+(s?e:r(e))+"</code></pre>\n",n&&n.length>0){var o="";o='<div class="code-hl">\n';for(var l=0;l<n.length;l++)o+='<div class="code-hl-item" style="top:"',o+=20*(n-1)+16,o+='px"></div>\n';i=o+i+"</div>"}return i},c.prototype.html=function(e){return e},c.prototype.footnote=function(e){var t='<hr class="footnote-sep"'+(this.options.xhtml?" /":"")+">\n";t+='<ol class="footnote-list">';for(var n=0;n<e.length;n++){var s=n+1;t+='<li id="fn'+s+'" class="footnote-item"><p>'+e[n]+'<a class="footnote-backref" href="#fnref'+s+'">↩</a></p></li>'}return t+="</ol>"},c.prototype.text=function(e){return e},c.prototype.table=function(e,t){return t&&(t="<tbody>"+t+"</tbody>"),"<table>\n<thead>\n"+e+"</thead>\n"+t+"</table>\n"},c.prototype.tablecell=function(e,t,n){return"<"+e+(n?' align="'+n+'"':"")+">"+t+"</"+e+">\n"},c.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},c.prototype.formula=function(e){return'<div class="formula">\n'+e+"</div>\n"},c.prototype.inlineFormula=function(e){return'<span class="formula">'+e+"</span>"},c.prototype.div=function(e,t){return'<div class="'+t+'">\n'+e+"</div>\n"},c.prototype.list=function(e,t){var n=t>0?"ol":"ul",s=t>1?' start="'+t+'"':"";return"<"+n+s+">\n"+e+"</"+n+">\n"},t(["li","dl","dt","dd","p"],function(e){c.prototype[e]=function(t){return"<"+e+">"+t+"</"+e+">\n"}}),c.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},c.prototype.paragraph=c.prototype.p,c.prototype.img=c.prototype.image,t(["strong","em","ins","mark","del","sub","sup"],function(e){c.prototype[e]=function(t){return"<"+e+">"+t+"</"+e+">"}}),c.prototype.codespan=function(e){return"<code>"+e+"</code>"},c.prototype.link=function(e,t,n){return'<a href="'+r(e,!0)+'"'+(n?' title="'+n+'"':"")+">"+t+"</a>"},c.prototype.image=function(e,t,n){return'<img src="'+e+'" alt="'+t+'"'+(n?' title="'+n+'"':"")+(this.options.xhtml?" />":">")},c.prototype.checkbox=function(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},u.rules=x,u.prototype.escape=function(e){return e.replace(this.rules._escape,"$1")},u.prototype.mangle=function(e){for(var t,n="",s=0;s<e.length;s++)t=e.charCodeAt(s),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},u.prototype.smartypants=function(e){return e.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014\/([{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/([{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")},u.prototype.link=function(e,t,n,s){return n=this.escape(n),s=r(this.escape(s)),e?this.renderer.image(n,r(t,!0),s):this.renderer.link(n,this.compile(t),s)},u.compile=function(e,t,n,s){var r=new u(t,n,s);return r.compile(e)},u.prototype.compile=function(e){for(var t,s,i,l,a,h="";e;)(a=this.rules.escape.exec(e))?(e=e.substring(a[0].length),h+=escape(a[1])):(a=this.rules.html.exec(e))?(this.inLink&&/^<\/a *>/i.test(a[0])?this.inLink=!1:!this.inLink&&/^<a /i.test(a[0])&&(this.inLink=!0),this.inRawBlock&&/^<\/(pre|code|kbd|script|math)(\s|>)/i.test(a[0])?this.inRawBlock=!1:!this.inRawBlock&&/^<(pre|code|kbd|script|math)(\s|>)/i.test(a[0])&&(this.inRawBlock=!0),e=e.substring(a[0].length),h+=a[0]):(a=this.rules.link.exec(e))?(e=e.substring(a[0].length),this.inLink=!0,s=o(a[1]||""),t=o(a[2]||a[3]),l=o(a[4]||a[5]||a[6]||""),h+=this.link("!"===a[0][0],s,t,l),this.inLink=!1):this.options.footnote&&(a=this.rules.footnote.exec(e))&&(s=o(a[1]).toLowerCase().replace(/\s+/g," "),t=this.fnrefs[s])?(t.index||(this.fnrefs.__n.push(this.compile(t.text)),t.index=this.fnrefs.__n.length),h+='<a href="#fn1" id="fnref1">[1]</a>'.replace(/1/g,t.index),e=e.substring(a[0].length)):((a=this.rules.reflink.exec(e))||(a=this.rules.nolink.exec(e)))&&(s=o(a[1]),t=o(a[2]||a[1]).toLowerCase().replace(/\s+/g," "),t=this.refs[t])?(this.inLink=!0,h+=this.link("!"===a[0][0],s,t.href,t.title),this.inLink=!1,e=e.substring(a[0].length)):(a=this.rules.code.exec(e))?(e=e.substring(a[0].length),s=a[2],/^ *$/.test(s)||(s=s.replace(/^( +)([\s\S]*?)\1$/,"$2")),h+=this.renderer.codespan(r(s))):(a=this.rules.strong.exec(e))?(e=e.substring(a[0].length),h+=this.renderer.strong(this.compile(a[4]||a[3]||a[2]||a[1]))):(a=this.rules.em.exec(e))?(e=e.substring(a[0].length),h+=this.renderer.em(this.compile(a[6]||a[5]||a[4]||a[3]||a[2]||a[1]))):(a=this.rules.br.exec(e))?(e=e.substring(a[0].length),h+=this.renderer.br()):(a=this.rules.del.exec(e))?(e=e.substring(a[0].length),h+=this.renderer.del(this.compile(a[1]))):(a=this.rules.mark.exec(e))?(e=e.substring(a[0].length),h+=this.renderer.mark(this.compile(a[1]))):(a=this.rules.ins.exec(e))?(e=e.substring(a[0].length),h+=this.renderer.ins(this.compile(a[1]))):(a=this.rules.autolink.exec(e))?(e=e.substring(a[0].length),"@"===a[2]?(s=r(this.options.mangle?this.mangle(a[1]):a[1],!0),i="mailto:"+s):(s=r(a[1],!0),i=s),h+=this.renderer.link(i,s)):this.options.formula&&(a=this.rules.formula.exec(e))?(e=e.substring(a[0].length),h+=this.renderer.inlineFormula(r(a[1],!0))):!this.inLink&&this.options.autourl&&(a=this.rules.url.exec(e))?("@"===a[2]?(s=r(a[1],!0),i="mailto:"+s):(s=a[0],s=r(s,!0),i="w"===s[0]?"http://"+s:s),h+=this.renderer.link(i,s),e=e.substring(a[0].length)):(a=this.rules.text.exec(e))?(e=e.substring(a[0].length),this.inRawBlock?h+=this.renderer.text(a[0]):(s=r(a[0],!0),this.options.smartypants&&(s=this.smartypants(s)),h+=this.renderer.text(s))):e&&n("Unrecognized byte:"+e.charCodeAt(0));return h},g.parse=function(e,t){var n=new g(t);return n.parse(e)},g.prototype.parse=function(e){this.compiler=new u(this.options,e.refs,e.fnrefs),this.tokens=e.slice().reverse();for(var t="";this.next();)t+=this.compile();return this.options.footnote&&this.compiler.fnrefs.__n.length>0&&(t+=this.renderer.footnote(this.compiler.fnrefs.__n)),t},g.prototype.next=function(){return this.token=this.tokens.pop(),this.token},g.prototype.peek=function(){return this.tokens[this.tokens.length-1]||{}},g.prototype.compile=function(){function e(e,t){var n=m.dt(b.compile(e));for(p=0;p<t.length;p++)n+=m.dd(b.compile(o(t[p])));return n}var t,s,i,l,a,h,p,c,u,g=this.token,f=g.type,d=g.text,m=this.renderer,b=this.compiler,k=this.peek().type;switch(f){case"hr":return m.hr();case"heading":return this.options.headerIds?(t=this.slugger.get(d),s=' id="'+t+'"'):s="",m.heading(b.compile(d),g.level,s);case"code":return m.code(d);case"fence":return m.fence(d,g.lang,g.lines);case"table":for(l="",a="",p=0;p<g.header.length;p++)a+=m.tablecell("th",b.compile(g.header[p]),g.align[p]);for(i=m.tablerow(a),p=0;p<g.cells.length;p++){for(h=g.cells[p],a="",c=0;c<h.length;c++)a+=m.tablecell("td",b.compile(h[c]),g.align[c]);l+=m.tablerow(a)}return m.table(i,l);case"deflist":return u=e(g.dt,g.dd),k===f&&(g=this.next(),u+=e(g.dt,g.dd)),m.dl(u);case"blockquote_open":for(l="",c=1;this.peek().type===f;)this.next(),c++;for(;"blockquote_close"!==this.next().type;)l+=this.compile();for(;this.peek().type&&"blockquote_close"===this.peek().type;)this.next();for(p=0;p<c;p++)l=m.blockquote(l);return l;case"div_open":for(l="";"div_close"!==this.next().type;)l+=this.compile();return m.div(l,r(g.kls));case"list_open":for(l="";"list_close"!==this.next().type;)l+=this.compile();return m.list(l,g.start);case"item_open":for(l="",g.task&&(l+=m.checkbox(g.checked));"item_close"!==this.next().type;)l+=g.loose||"text"!==this.token.type?this.compile():this.parseText();return m.li(l);case"formula":return m.formula(g.raw);case"html":return m.html(d);case"paragraph":return m.paragraph(b.compile(d));case"text":return m.paragraph(this.parseText());default:n("Unknown type:"+f)}},g.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.compiler.compile(e)},f.defaults={langPrefix:"lang-",headerIds:!0,headerPrefix:"",formula:!1,footnote:!0,highlight:null,xhtml:!1},f.Lexer=a,f.InlineLexer=u,f.Parser=g,f.Renderer=c,f.parse=f,f});